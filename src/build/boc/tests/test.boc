include ../../../../rules/test.boc;

var $(BOC)=$(BUILD_BIN)/boc;
var $(BOC_OPTS);
var $(BOC_NO_PROGRESS)=--no-progress;

function setup_test_project()
{
    cp -r project $(TESTSUITE_DIR)/project;
    pushd $(TESTSUITE_DIR)/project;
}

function teardown_test_project()
{
    popd;

    echo "==== stderr ====" >> $(RAW_OUTPUT);
    cat $(TESTSUITE_DIR)/stderr >> $(RAW_OUTPUT);

    echo "==== stdout ====" >> $(RAW_OUTPUT);
    cat $(TESTSUITE_DIR)/stdout >> $(RAW_OUTPUT);

    call process_raw_output();
    call compare_output();
}

function run_boc(opts)
{
    $(BOC)
        $(opts)
        $(BOC_NO_PROGRESS)
        >>$(TESTSUITE_DIR)/stdout
        2>>$(TESTSUITE_DIR)/stderr
        || true;
}

function inner_begin_project_phase(phase)
{
    echo $(phase) >>$(TESTSUITE_DIR)/stdout;
    echo $(phase) >>$(TESTSUITE_DIR)/stderr;
    echo $(phase) >>$(RAW_OUTPUT);
}

function begin_project_phase(phase)
{
    call inner_begin_project_phase("---- "$(phase)" ----");
}
